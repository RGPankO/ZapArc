<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightning Tipping Extension</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="notification-container"></div>

    <!-- Modal System -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <!-- PIN Entry Modal -->
        <div id="pin-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Enter PIN</h3>
                <button class="modal-close" id="pin-modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <p id="pin-modal-message">Enter your PIN to continue</p>
                <input type="password" id="pin-modal-input" class="modal-input" placeholder="Enter PIN" maxlength="20" autocomplete="off" />
                <div id="pin-modal-error" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="pin-modal-cancel" class="btn-secondary">Cancel</button>
                <button id="pin-modal-confirm" class="btn-primary">Confirm</button>
            </div>
        </div>

        <!-- Add Wallet Modal - Choice -->
        <div id="add-wallet-choice-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Add New Wallet</h3>
                <button class="modal-close" id="add-wallet-choice-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">Choose how you want to add a new wallet</p>
                <div class="choice-buttons">
                    <button id="modal-create-new-wallet-btn" class="choice-btn">
                        <span class="choice-icon">‚ú®</span>
                        <span class="choice-title">Create New Wallet</span>
                        <span class="choice-description">Generate a new 12-word recovery phrase</span>
                    </button>
                    <button id="modal-import-wallet-btn" class="choice-btn">
                        <span class="choice-icon">üì•</span>
                        <span class="choice-title">Import Existing Wallet</span>
                        <span class="choice-description">Enter your 12-word recovery phrase</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="add-wallet-choice-cancel" class="btn-secondary">Cancel</button>
            </div>
        </div>

        <!-- Add Wallet Modal - Create New (Nickname) -->
        <div id="add-wallet-create-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Create New Wallet</h3>
                <button class="modal-close" id="add-wallet-create-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">Enter a nickname for this wallet</p>
                <input type="text" id="create-wallet-nickname" class="modal-input" placeholder="e.g., Savings Wallet" maxlength="50" />
                <div id="create-wallet-error" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="create-wallet-back" class="btn-secondary">Back</button>
                <button id="create-wallet-next" class="btn-primary">Generate Wallet</button>
            </div>
        </div>

        <!-- Add Wallet Modal - Show Mnemonic -->
        <div id="add-wallet-mnemonic-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Your Recovery Phrase</h3>
                <button class="modal-close" id="add-wallet-mnemonic-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: #666; font-size: 13px;">Write down these 12 words in order. You'll need them to recover your wallet.</p>
                <div id="modal-mnemonic-display" class="mnemonic-grid"></div>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important:</strong> Store this phrase safely offline. Anyone with these words can access your funds.
                </div>
                <button id="copy-mnemonic-btn" class="btn-outline" style="width: 100%; margin-top: 12px;">üìã Copy to Clipboard</button>
            </div>
            <div class="modal-footer">
                <button id="mnemonic-modal-back" class="btn-secondary">Back</button>
                <button id="mnemonic-modal-confirm" class="btn-primary">I've Saved It</button>
            </div>
        </div>

        <!-- Add Wallet Modal - Import (Nickname) -->
        <div id="add-wallet-import-nickname-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Import Existing Wallet</h3>
                <button class="modal-close" id="add-wallet-import-nickname-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">Enter a nickname for this wallet</p>
                <input type="text" id="import-wallet-nickname" class="modal-input" placeholder="e.g., My Mobile Wallet" maxlength="50" />
                <div id="import-nickname-error" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="import-nickname-back" class="btn-secondary">Back</button>
                <button id="import-nickname-next" class="btn-primary">Next</button>
            </div>
        </div>

        <!-- Add Wallet Modal - Import (Mnemonic Entry) -->
        <div id="add-wallet-import-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Enter Recovery Phrase</h3>
                <button class="modal-close" id="add-wallet-import-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: #666; font-size: 13px;">Enter your 12-word recovery phrase</p>
                <div id="modal-import-words-container" class="import-words-grid"></div>
                <div id="modal-word-suggestions" class="word-suggestions"></div>
                <div id="import-mnemonic-error" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="import-modal-back" class="btn-secondary">Back</button>
                <button id="import-modal-confirm" class="btn-primary" disabled>Import Wallet</button>
            </div>
        </div>

        <!-- Rename Wallet Modal -->
        <div id="rename-wallet-modal" class="modal hidden">
            <div class="modal-header">
                <h3>Rename Wallet</h3>
                <button class="modal-close" id="rename-wallet-close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">Enter a new nickname for this wallet</p>
                <input type="text" id="rename-wallet-input" class="modal-input" placeholder="Wallet nickname" maxlength="50" />
                <div id="rename-wallet-error" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="rename-wallet-cancel" class="btn-secondary">Cancel</button>
                <button id="rename-wallet-save" class="btn-primary">Save</button>
            </div>
        </div>
    </div>

    <div id="app">
        <!-- Onboarding Wizard (hidden by default) -->
        <div id="onboarding-wizard" class="hidden">
            <div class="wizard-step" id="welcome-step">
                <div class="wizard-header">
                    <h2>‚ö° Welcome to Lightning Tipping</h2>
                    <p>Set up your Lightning wallet to start tipping and receiving tips</p>
                </div>
                <div class="wizard-content">
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="feature-icon">üîí</span>
                            <span>Non-custodial wallet - you control your keys</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">‚ö°</span>
                            <span>Instant Lightning Network payments</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üåê</span>
                            <span>Works on any website</span>
                        </div>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="start-setup-btn" class="btn-primary">Set Up Wallet</button>
                    <button id="skip-setup-btn" class="btn-secondary">Skip Setup</button>
                </div>
            </div>

            <!-- New: Choose wallet setup type -->
            <div class="wizard-step hidden" id="setup-choice-step">
                <div class="wizard-header">
                    <h2>Set Up Your Wallet</h2>
                    <p>Choose how you want to set up your wallet</p>
                </div>
                <div class="wizard-content">
                    <div class="choice-buttons">
                        <button id="create-new-wallet-btn" class="choice-btn">
                            <span class="choice-icon">‚ú®</span>
                            <span class="choice-title">Create New Wallet</span>
                            <span class="choice-description">Generate a new 12-word recovery phrase</span>
                        </button>
                        <button id="import-wallet-btn" class="choice-btn">
                            <span class="choice-icon">üì•</span>
                            <span class="choice-title">Import Existing Wallet</span>
                            <span class="choice-description">Enter your 12-word recovery phrase</span>
                        </button>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="choice-back-btn" class="btn-secondary">Back</button>
                </div>
            </div>

            <!-- New: Import wallet step -->
            <div class="wizard-step hidden" id="import-wallet-step">
                <div class="wizard-header">
                    <h2>Import Wallet</h2>
                    <p>Enter your 12-word recovery phrase</p>
                </div>
                <div class="wizard-content">
                    <div id="import-words-container" class="import-words-grid"></div>
                    <div id="word-suggestions" class="word-suggestions"></div>
                </div>
                <div class="wizard-actions">
                    <button id="import-back-btn" class="btn-secondary">Back</button>
                    <button id="import-confirm-btn" class="btn-primary" disabled>Continue</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="mnemonic-step">
                <div class="wizard-header">
                    <h2>üîë Your Recovery Phrase</h2>
                    <p>Write down these 12 words in order. You'll need them to recover your wallet.</p>
                </div>
                <div class="wizard-content">
                    <div id="mnemonic-display" class="mnemonic-grid"></div>
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> Store this phrase safely offline. Anyone with these words can access your funds.
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="mnemonic-back-btn" class="btn-secondary">Back</button>
                    <button id="mnemonic-continue-btn" class="btn-primary">I've Written It Down</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="confirm-step">
                <div class="wizard-header">
                    <h2>‚úÖ Confirm Your Recovery Phrase</h2>
                    <p>Select the words in the correct order to confirm you've backed up your phrase</p>
                </div>
                <div class="wizard-content">
                    <div id="confirmation-display">
                        <div id="selected-words" class="selected-words"></div>
                        <div id="word-options" class="word-options"></div>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="confirm-back-btn" class="btn-secondary">Back</button>
                    <button id="confirm-continue-btn" class="btn-primary" disabled>Continue</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="pin-step">
                <div class="wizard-header">
                    <h2>üîê Create Your PIN</h2>
                    <p>Create a 6+ digit PIN to secure your wallet</p>
                </div>
                <div class="wizard-content">
                    <div class="pin-input-group">
                        <input type="password" id="pin-input" placeholder="Enter PIN (6+ digits)" maxlength="20">
                        <input type="password" id="pin-confirm" placeholder="Confirm PIN" maxlength="20">
                    </div>
                    <div class="pin-strength" id="pin-strength"></div>
                </div>
                <div class="wizard-actions">
                    <button id="pin-back-btn" class="btn-secondary">Back</button>
                    <button id="pin-continue-btn" class="btn-primary" disabled>Create Wallet</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="setup-complete-step">
                <div class="wizard-header">
                    <h2>üéâ Wallet Created Successfully!</h2>
                    <p>Your Lightning wallet is ready to use</p>
                </div>
                <div class="wizard-content">
                    <div class="success-message">
                        <div class="checkmark">‚úì</div>
                        <p>You can now send and receive Lightning payments securely</p>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="complete-setup-btn" class="btn-primary">Start Using Wallet</button>
                </div>
            </div>
        </div>

        <!-- Wallet Management Interface -->
        <div id="wallet-management-interface" class="hidden">
            <header>
                <button id="wallet-mgmt-back-btn" class="back-btn">‚Üê Back</button>
                <h1>Manage Wallets</h1>
                <button id="wallet-mgmt-add-btn" class="add-wallet-top-btn" title="Add New Wallet">+ Add Wallet</button>
            </header>

            <main>
                <div id="wallet-management-list" class="wallet-management-list">
                    <!-- Populated dynamically with wallet items -->
                </div>
            </main>
        </div>

        <!-- Main Wallet Interface -->
        <div id="main-interface" class="hidden">
            <header>
                <h1>Lightning Tipping</h1>
                <button id="refresh-btn" class="refresh-btn" title="Refresh Balance">üîÑ</button>
            </header>

            <main>
                <!-- Multi-Wallet Selector -->
                <div id="wallet-selector" class="wallet-selector hidden">
                    <div class="wallet-selector-header">
                        <button id="current-wallet-btn" class="current-wallet-btn">
                            <span id="current-wallet-name">Wallet 1</span>
                            <span class="wallet-count-badge" id="wallet-count-badge">1</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <button id="add-wallet-btn" class="add-wallet-btn" title="Add New Wallet">+</button>
                    </div>

                    <!-- Dropdown Menu (hidden by default) -->
                    <div id="wallet-dropdown" class="wallet-dropdown hidden">
                        <div id="wallet-list" class="wallet-list">
                            <!-- Populated dynamically -->
                        </div>
                        <div class="wallet-dropdown-footer">
                            <button id="manage-wallets-btn" class="manage-wallets-btn">
                                ‚öôÔ∏è Manage Wallets
                            </button>
                        </div>
                    </div>
                </div>

                <div id="wallet-section">
                    <div id="balance-display">
                        <div class="balance-label">Balance</div>
                        <div id="balance" class="balance-amount">-- sats</div>
                        <div id="balance-loading" class="balance-loading hidden">Updating...</div>
                    </div>
                    
                    <div id="wallet-actions">
                        <button id="deposit-btn" class="wallet-btn">
                            <span class="btn-icon">üì•</span>
                            Deposit
                        </button>
                        <button id="withdraw-btn" class="wallet-btn">
                            <span class="btn-icon">üì§</span>
                            Withdraw
                        </button>
                    </div>
                </div>

                <div id="transaction-section">
                    <div class="section-header">
                        <h3>Recent Transactions</h3>
                        <button id="view-all-btn" class="view-all-btn">View All</button>
                    </div>
                    <div id="transaction-list" class="transaction-list">
                        <div class="no-transactions">No transactions yet</div>
                    </div>
                </div>
                
                <div id="settings-section">
                    <button id="settings-btn" class="settings-btn">‚öôÔ∏è Settings</button>
                    <button id="delete-wallet-btn" class="delete-wallet-btn">üóëÔ∏è Delete Wallet</button>
                </div>
            </main>
        </div>

        <!-- Unlock Interface -->
        <div id="unlock-interface" class="hidden">
            <div class="unlock-container">
                <h2>üîí Wallet Locked</h2>
                <p>Enter your PIN to unlock your wallet</p>
                <div class="pin-input-container">
                    <input type="password" id="unlock-pin" placeholder="Enter PIN" maxlength="20">
                    <button id="unlock-btn" class="btn-primary">Unlock</button>
                </div>
                <div id="unlock-error" class="error-message hidden"></div>
                <a href="#" id="forgot-pin-link" style="display: block; text-align: center; margin-top: 12px; font-size: 12px; color: #666; text-decoration: underline; cursor: pointer;">Forgot PIN?</a>
            </div>
        </div>

        <!-- Rename Wallet Interface -->
        <div id="rename-wallet-interface" class="hidden">
            <div class="wizard-header">
                <button id="rename-back-btn" class="back-btn">‚Üê Back</button>
                <h2>Rename Wallet</h2>
            </div>
            <div class="wizard-content">
                <p style="margin-bottom: 16px; color: #666; font-size: 14px;">Enter a new name for your wallet</p>
                <div class="form-group">
                    <input type="text" id="rename-wallet-name-input" class="form-input" placeholder="Wallet name" maxlength="50" />
                </div>
                <div id="rename-error-message" class="error-message hidden"></div>
            </div>
            <div class="wizard-actions">
                <button id="rename-save-btn" class="btn-primary">Save</button>
            </div>
        </div>

        <!-- QR Only Interface -->
        <div id="qr-only-interface" class="hidden">
            <header>
                <h1>‚ö° Lightning Tipping</h1>
                <p class="mode-indicator">External Wallet Mode</p>
            </header>
            
            <main>
                <div class="info-box">
                    <h3>External Wallet Mode</h3>
                    <p>Tip detection is active. QR codes will be generated for your external Lightning wallet.</p>
                </div>
                
                <div class="qr-actions">
                    <button id="setup-wallet-later" class="btn-outline">Set Up Wallet</button>
                    <button id="settings-btn-qr" class="btn-outline">Settings</button>
                </div>
            </main>
        </div>
    </div>
    
    <script src="popup.js"></script>
</body>
</html>