<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightning Tipping Extension</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="notification-container"></div>
    <div id="app">
        <!-- Onboarding Wizard (hidden by default) -->
        <div id="onboarding-wizard" class="hidden">
            <div class="wizard-step" id="welcome-step">
                <div class="wizard-header">
                    <h2>‚ö° Welcome to Lightning Tipping</h2>
                    <p>Set up your Lightning wallet to start tipping and receiving tips</p>
                </div>
                <div class="wizard-content">
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="feature-icon">üîí</span>
                            <span>Non-custodial wallet - you control your keys</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">‚ö°</span>
                            <span>Instant Lightning Network payments</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üåê</span>
                            <span>Works on any website</span>
                        </div>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="start-setup-btn" class="btn-primary">Set Up Wallet</button>
                    <button id="skip-setup-btn" class="btn-secondary">Skip Setup</button>
                </div>
            </div>

            <!-- New: Choose wallet setup type -->
            <div class="wizard-step hidden" id="setup-choice-step">
                <div class="wizard-header">
                    <h2>Set Up Your Wallet</h2>
                    <p>Choose how you want to set up your wallet</p>
                </div>
                <div class="wizard-content">
                    <div class="choice-buttons">
                        <button id="create-new-wallet-btn" class="choice-btn">
                            <span class="choice-icon">‚ú®</span>
                            <span class="choice-title">Create New Wallet</span>
                            <span class="choice-description">Generate a new 12-word recovery phrase</span>
                        </button>
                        <button id="import-wallet-btn" class="choice-btn">
                            <span class="choice-icon">üì•</span>
                            <span class="choice-title">Import Existing Wallet</span>
                            <span class="choice-description">Enter your 12-word recovery phrase</span>
                        </button>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="choice-back-btn" class="btn-secondary">Back</button>
                </div>
            </div>

            <!-- New: Import wallet step -->
            <div class="wizard-step hidden" id="import-wallet-step">
                <div class="wizard-header">
                    <h2>Import Wallet</h2>
                    <p>Enter your 12-word recovery phrase</p>
                </div>
                <div class="wizard-content">
                    <div id="import-words-container" class="import-words-grid"></div>
                    <div id="word-suggestions" class="word-suggestions"></div>
                </div>
                <div class="wizard-actions">
                    <button id="import-back-btn" class="btn-secondary">Back</button>
                    <button id="import-confirm-btn" class="btn-primary" disabled>Continue</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="mnemonic-step">
                <div class="wizard-header">
                    <h2>üîë Your Recovery Phrase</h2>
                    <p>Write down these 12 words in order. You'll need them to recover your wallet.</p>
                </div>
                <div class="wizard-content">
                    <div id="mnemonic-display" class="mnemonic-grid"></div>
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> Store this phrase safely offline. Anyone with these words can access your funds.
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="mnemonic-back-btn" class="btn-secondary">Back</button>
                    <button id="mnemonic-continue-btn" class="btn-primary">I've Written It Down</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="confirm-step">
                <div class="wizard-header">
                    <h2>‚úÖ Confirm Your Recovery Phrase</h2>
                    <p>Select the words in the correct order to confirm you've backed up your phrase</p>
                </div>
                <div class="wizard-content">
                    <div id="confirmation-display">
                        <div id="selected-words" class="selected-words"></div>
                        <div id="word-options" class="word-options"></div>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="confirm-back-btn" class="btn-secondary">Back</button>
                    <button id="confirm-continue-btn" class="btn-primary" disabled>Continue</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="pin-step">
                <div class="wizard-header">
                    <h2>üîê Create Your PIN</h2>
                    <p>Create a 6+ digit PIN to secure your wallet</p>
                </div>
                <div class="wizard-content">
                    <div class="pin-input-group">
                        <input type="password" id="pin-input" placeholder="Enter PIN (6+ digits)" maxlength="20">
                        <input type="password" id="pin-confirm" placeholder="Confirm PIN" maxlength="20">
                    </div>
                    <div class="pin-strength" id="pin-strength"></div>
                </div>
                <div class="wizard-actions">
                    <button id="pin-back-btn" class="btn-secondary">Back</button>
                    <button id="pin-continue-btn" class="btn-primary" disabled>Create Wallet</button>
                </div>
            </div>

            <div class="wizard-step hidden" id="setup-complete-step">
                <div class="wizard-header">
                    <h2>üéâ Wallet Created Successfully!</h2>
                    <p>Your Lightning wallet is ready to use</p>
                </div>
                <div class="wizard-content">
                    <div class="success-message">
                        <div class="checkmark">‚úì</div>
                        <p>You can now send and receive Lightning payments securely</p>
                    </div>
                </div>
                <div class="wizard-actions">
                    <button id="complete-setup-btn" class="btn-primary">Start Using Wallet</button>
                </div>
            </div>
        </div>

        <!-- Main Wallet Interface -->
        <div id="main-interface" class="hidden">
            <header>
                <h1>Lightning Tipping</h1>
                <button id="refresh-btn" class="refresh-btn" title="Refresh Balance">üîÑ</button>
            </header>
            
            <main>
                <div id="wallet-section">
                    <div id="balance-display">
                        <div class="balance-label">Balance</div>
                        <div id="balance" class="balance-amount">-- sats</div>
                        <div id="balance-loading" class="balance-loading hidden">Updating...</div>
                    </div>
                    
                    <div id="wallet-actions">
                        <button id="deposit-btn" class="wallet-btn">
                            <span class="btn-icon">üì•</span>
                            Deposit
                        </button>
                        <button id="withdraw-btn" class="wallet-btn">
                            <span class="btn-icon">üì§</span>
                            Withdraw
                        </button>
                    </div>
                </div>

                <div id="transaction-section">
                    <div class="section-header">
                        <h3>Recent Transactions</h3>
                        <button id="view-all-btn" class="view-all-btn">View All</button>
                    </div>
                    <div id="transaction-list" class="transaction-list">
                        <div class="no-transactions">No transactions yet</div>
                    </div>
                </div>
                
                <div id="settings-section">
                    <button id="settings-btn" class="settings-btn">‚öôÔ∏è Settings</button>
                    <button id="delete-wallet-btn" class="delete-wallet-btn">üóëÔ∏è Delete Wallet</button>
                </div>
            </main>
        </div>

        <!-- Unlock Interface -->
        <div id="unlock-interface" class="hidden">
            <div class="unlock-container">
                <h2>üîí Wallet Locked</h2>
                <p>Enter your PIN to unlock your wallet</p>
                <div class="pin-input-container">
                    <input type="password" id="unlock-pin" placeholder="Enter PIN" maxlength="20">
                    <button id="unlock-btn" class="btn-primary">Unlock</button>
                </div>
                <div id="unlock-error" class="error-message hidden"></div>
                <a href="#" id="forgot-pin-link" style="display: block; text-align: center; margin-top: 12px; font-size: 12px; color: #666; text-decoration: underline; cursor: pointer;">Forgot PIN?</a>
            </div>
        </div>

        <!-- QR Only Interface -->
        <div id="qr-only-interface" class="hidden">
            <header>
                <h1>‚ö° Lightning Tipping</h1>
                <p class="mode-indicator">External Wallet Mode</p>
            </header>
            
            <main>
                <div class="info-box">
                    <h3>External Wallet Mode</h3>
                    <p>Tip detection is active. QR codes will be generated for your external Lightning wallet.</p>
                </div>
                
                <div class="qr-actions">
                    <button id="setup-wallet-later" class="btn-outline">Set Up Wallet</button>
                    <button id="settings-btn-qr" class="btn-outline">Settings</button>
                </div>
            </main>
        </div>
    </div>
    
    <script src="popup.js"></script>
</body>
</html>